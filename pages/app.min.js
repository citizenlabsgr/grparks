"use strict";function isEverythingReady(){if(baseMap.ready&&geojsonCity.ready&&geojsonWards.ready&&geojsonNeighborhoods.ready&&geojsonParks.ready){ids=void 0,makeParkList(),geojsonCity.layer.addTo(baseMap.map),geojsonParks.layer.addTo(baseMap.map);var e;for(e in overlayLayers)overlayLayers[e].addTo(baseMap.map);geojsonWards.layer.addTo(baseLayers.Wards),geojsonNeighborhoods.layer.addTo(baseLayers.Neighborhoods),L.control.layers(baseLayers,overlayLayers,{position:"topright",collapsed:!1}).addTo(baseMap.map),colorUnits(wards),colorUnits(neighborhoods)}}function geojsonLayer(e,r){return this.layer,this.ready=!1,this.style=r,this.url=e,this.getData=function(){var e=new XMLHttpRequest;e.overrideMimeType&&e.overrideMimeType("application/json"),e.open("GET",this.url,!0);var r=this;e.onreadystatechange=function(){4==e.readyState&&"200"==e.status&&(r.layer=new L.layerGroup,L.geoJson(JSON.parse(e.responseText),{onEachFeature:r.onEachFeature,style:r.style}).addTo(r.layer),r.ready=!0,isEverythingReady())},e.send(null)},this}function addMarker(e,r){var a=L.Icon.Default.extend({options:{}});if(-1==ids.indexOf(e.id)&&e.properties&&e.properties.name){ids.push(e.id);var o=r.getBounds().getCenter();e.properties.latitude&&e.properties.longitude&&(o=L.latLng(e.properties.latitude,e.properties.longitude)),thisMarker=L.marker(o,{icon:new a({iconUrl:srcFromMarkerType(e.properties.type)}),riseOnHover:!0}).addTo(overlayLayers[labelMarker(e.properties.type.split(" ")[0])]),thisMarker.money=Number(e.properties.millage.replace(".00","").replace("$","").replace(",","")),thisMarker.on({click:function(e){markerClicked=!0},popupopen:function(e){clickPark(e,!0)},popupclose:function(e){clickPark(e,!1)}}),thisMarker.park={name:e.properties.name,acreage:e.properties.acreage,pool:e.properties.pool,millage:e.properties.millage},thisMarker.type=e.properties.type+" "+e.properties.leisure;var t="description of improvements would go here";e.properties.description&&(t=e.properties.description),thisMarker.bindPopup("<h3>"+thisMarker.park.name+"</h3><p>"+thisMarker.type+"</p>"+t,{closeButton:!1,maxHeight:300}),markers.push(thisMarker)}}function makeParkList(){markers.sort(function(e,r){return e.park.name.toUpperCase()>r.park.name.toUpperCase()?1:-1});var e,r,a,o,t;for(i=0;i<markers.length;i++){thisMarker=markers[i],a=JSON.parse(JSON.stringify(thisMarker.park)),o=document.createElement("a"),t=document.createElement("li"),thisMarker.index=i,o.href="javascript:pop("+i+");",o.title=a.name,o.appendChild(imgFromMarkerType(thisMarker.type));for(r in a){switch(e=document.createElement("p"),r){case"acreage":e.textContent=a[r]+" acres";break;case"millage":a[r]?e.innerHTML=a[r].replace(".00","")+"&nbsp;<i class='fa fa-info-circle fa-lg'></i>":e.innerHTML="&nbsp;";break;case"pool":""==a[r]?e.innerHTML="&nbsp;":e.textContent=a[r]+" pool";break;default:e.textContent=a[r]}o.appendChild(e)}t.appendChild(o),parklist.appendChild(t),thisMarker.ward=polygonContainsMarker(thisMarker,wards),thisMarker.neighborhood=polygonContainsMarker(thisMarker,neighborhoods)}}function clickPark(e,r){var a=e.target.index;liPark(a).classList.toggle("highlight"),r&&markerClicked&&(liPark(a).scrollIntoView(),markerClicked=!1)}function colorUnits(e){for(i=0;i<e.length;i++)e[i].setStyle({fill:!0,fillColor:settings.choropleth.color(e[i].feature.properties.money)})}function imgFromMarkerType(e){var r=document.createElement("img");return r.src=srcFromMarkerType(e),r}function labelMarker(e){return"<img src='"+srcFromMarkerType(e)+"' class='small'>"+e}function liPark(e){return parklist.getElementsByTagName("li")[e]}function overlayChanged(e,r){overlayLayers[e.name].eachLayer(function(e){liPark(e.index).style.display=r?"block":"none";var a;a=r?e.money:-e.money,-1!=e.neighborhood&&(neighborhoods[e.neighborhood].feature.properties.money+=a),-1!=e.ward&&(wards[e.ward].feature.properties.money+=a)}),colorUnits(wards),colorUnits(neighborhoods)}function polygonContainsMarker(e,r){var a,o,t,s,n,i,p,l,g,c,h,d;for(a=0;a<r.length;a++){for(o=r[a].getLatLngs(),t=e.getLatLng().lat,s=e.getLatLng().lng,h=!1,n=0,i=o.length-1;n<o.length;i=n++)p=o[n].lat,l=o[n].lng,g=o[i].lat,c=o[i].lng,d=l>s!=c>s&&(g-p)*(s-l)/(c-l)+p>t,d&&(h=!h);if(h)return r[a].feature.properties.money+=e.money,a}return-1}function pop(e){thisMarker=markers[e];var r=thisMarker.getLatLng(),a=baseMap.map.getZoom();15>a&&(a=15),baseMap.map.setView(r,a,{animation:!0}),thisMarker.openPopup()}function resetMapInfo(e){var r;r="Wards"==e?geojsonWards.layer:geojsonNeighborhoods.layer,r.getLayers()[0].setStyle(settings.polygons.style),mapInfo.update(e)}function setMapInfo(e,r){resetMapInfo(e),r.target.setStyle(settings.polygons.highlight),mapInfo.update(e,r.target.feature.properties)}function srcFromMarkerType(e){return settings.icons+e.split(" ")[0].toLowerCase()+".png"}var settings={choropleth:{color:function(e){return e>=1e6?"#7a0177":e>=75e4?"#c51b8a":e>=5e5?"#f768a1":e>=25e4?"#fbb4b9":e>=1?"#feebe2":"transparent"},money:[1,25e4,5e5,75e4,1e6]},city:{center:{lat:42.9614844,lon:-85.6556833},style:{color:"gray",weight:3,fill:!1,clickable:!1},url:"https://raw.githubusercontent.com/friendlycode/gr-parks/gh-pages/gr.geojson"},icons:"images/marker-icons/",maps:{Default:"mapbox.emerald",Grayscale:"mapbox.light"},neighborhoods:{url:"https://raw.githubusercontent.com/friendlycode/gr-parks/gh-pages/neighborhoods.geojson"},parks:{style:{color:"#ff7800",weight:1,opacity:.65,clickable:!1},types:["Community","Mini","Neighborhood","Urban"],url:"https://raw.githubusercontent.com/friendlycode/gr-parks/gh-pages/parks.geojson"},polygons:{highlight:{weight:5,fill:!0,fillOpacity:.65,clickable:!0},style:{weight:1,fill:!0,fillOpacity:.65,clickable:!0}},wards:{url:"https://raw.githubusercontent.com/friendlycode/gr-parks/gh-pages/wards.geojson"}},ids=[],markers=[],neighborhoods=[],wards=[],baseLayers={},overlayLayers={},i,grayscale,markerClicked=!1,thisMarker,mapInfo=L.control({position:"bottomleft"});for(mapInfo.onAdd=function(e){var r=L.DomUtil.create("div","info");this.heading=L.DomUtil.create("div");var a,o,t=L.DomUtil.create("div"),s=[];for(s.push("<i style='background: transparent'></i>None"),i=0;i<settings.choropleth.money.length;i++)a=settings.choropleth.money[i],o=settings.choropleth.money[i+1]-1,s.push('<i style="background:'+settings.choropleth.color(a)+'"></i>$'+a.toLocaleString("en-US")+(o?"&ndash;"+o.toLocaleString("en-US"):"+"));return t.innerHTML=s.join("<br>"),r.appendChild(this.heading),r.appendChild(t),r},mapInfo.update=function(e,r){var a=e.slice(0,-1);this.heading.innerHTML="<h4>"+a+" Investment</h4>"+(r?"<b>"+r.label+"</b>: $"+r.money.toLocaleString("en-US"):"Hover over a "+a.toLowerCase())},i=0;i<settings.parks.types.length;i++)overlayLayers[labelMarker(settings.parks.types[i])]=new L.layerGroup;var geojsonCity=new geojsonLayer(settings.city.url,settings.city.style);geojsonCity.getData();var geojsonWards=new geojsonLayer(settings.wards.url,settings.polygons.style);geojsonWards.onEachFeature=function(e,r){r.on({click:function(e){setMapInfo("Wards",e)},mouseover:function(e){setMapInfo("Wards",e)},mouseout:function(e){resetMapInfo("Wards")}}),e.properties.label="Ward "+e.properties.WARD,e.properties.money=0,wards.push(r)},geojsonWards.getData();var geojsonNeighborhoods=new geojsonLayer(settings.neighborhoods.url,settings.polygons.style);geojsonNeighborhoods.onEachFeature=function(e,r){r.on({click:function(e){setMapInfo("Neighborhoods",e)},mouseover:function(e){setMapInfo("Neighborhoods",e)},mouseout:function(e){resetMapInfo("Neighborhoods")}}),e.properties.label=e.properties.NEBRH,e.properties.money=0,neighborhoods.push(r)},geojsonNeighborhoods.getData();var geojsonParks=new geojsonLayer(settings.parks.url,settings.parks.style);geojsonParks.onEachFeature=addMarker,geojsonParks.getData(),window.onload=function(){baseMap.init("map",settings.city.center),isEverythingReady()};var baseMap={ready:!1,init:function(e,r){var a="<a target='_blank' href='https://www.mapbox.com/about/maps/'>&copy; Mapbox</a> <a target='_blank' href='http://www.openstreetmap.org/copyright'>&copy; OpenStreetMap</a> <a target='_blank' href='https://www.mapbox.com/map-feedback/#/-85.596/42.997/14'><b>Improve this map</b></a>",o="https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiZ2l0aHViIiwiYSI6IjEzMDNiZjNlZGQ5Yjg3ZjBkNGZkZWQ3MTIxN2FkODIxIn0.o0lbEdOfJYEOaibweUDlzA";baseLayers.Default=new L.tileLayer(o,{id:settings.maps.Default,attribution:a,minZoom:11,maxZoom:17}),grayscale=L.tileLayer(o,{id:settings.maps.Grayscale,attribution:a,minZoom:11,maxZoom:17}),baseLayers.Wards=new L.layerGroup,baseLayers.Neighborhoods=new L.layerGroup,this.map=L.map(e,{center:r,zoom:12,layers:baseLayers.Default}),this.map.on({baselayerchange:function(e){try{mapInfo.removeFrom(baseMap.map),resetMapInfo()}catch(r){}"Default"==e.name?baseMap.map.removeLayer(grayscale):(baseMap.map.addLayer(grayscale),mapInfo.addTo(baseMap.map),mapInfo.update(e.name))},overlayadd:function(e){overlayChanged(e,!0)},overlayremove:function(e){overlayChanged(e,!1)}}),this.ready=!0}};